{"version":3,"sources":["node_modules/tslib/tslib.es6.js","ng://ngx-formly-designer/lib/wrappers/designer.ts","ng://ngx-formly-designer/lib/formly-designer-config.ts","ng://ngx-formly-designer/lib/util.ts","ng://ngx-formly-designer/lib/fields.service.ts","ng://ngx-formly-designer/lib/formly-designer.service.ts","ng://ngx-formly-designer/lib/wrappers/field-designer.ts","ng://ngx-formly-designer/lib/wrappers/field-group-designer.ts","ng://ngx-formly-designer/lib/run/designer.ts","ng://ngx-formly-designer/lib/config.ts","ng://ngx-formly-designer/lib/formly-designer.component.ts","ng://ngx-formly-designer/lib/components/field-editor.ts","ng://ngx-formly-designer/lib/components/field-picker.ts","ng://ngx-formly-designer/lib/components/type-select.ts","ng://ngx-formly-designer/lib/components/wrapper-editor.ts","ng://ngx-formly-designer/lib/components/wrapper-select.ts","ng://ngx-formly-designer/lib/components/wrapper-picker.ts","ng://ngx-formly-designer/lib/components/wrappers-picker.ts","ng://ngx-formly-designer/lib/json-helper.ts","ng://ngx-formly-designer/lib/pipes/decycle.ts","ng://ngx-formly-designer/lib/formly-designer.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__values","o","m","Symbol","iterator","i","call","next","length","value","done","tslib_1.__extends","FieldWrapper","Component","args","selector","template","ViewChild","read","ViewContainerRef","FormlyDesignerWrapperComponent","FORMLY_DESIGNER_CONFIG_TOKEN","InjectionToken","FormlyDesignerConfig","addConfig","config","settings","setSettings","types","setType","wrappers","setWrapper","showClassName","undefined","options","_this","isArray","forEach","option","formlyConfig","getType","name","type","fieldArray","fieldGroup","fields","getWrapper","wrapper","Injectable","Inject","FormlyConfig","configs","keyPathMemberName","getKeyPath","field","key","keyPath","pathElements","split","pathElements_1","tslib_1.__values","pathElements_1_1","pathElement","replace","concat","push","test","parseInt","path","slice","traverseFields","callback","parent","fields_1","fields_1_1","isObject","val","isString","String","FieldsService","getFullKeyPath","parents_1","Map","f","set","cur","get","getTypeFields","getFields","getWrapperFields","checkField","fullPathByField","newPath","equalType","a","mutateField","designerField","templateOptions","$designerField","mutateFields","designerFields","designerOption","getDesignerOptions","cloneDeep","formlyDesignerConfig","FormlyDesignerService","defineProperty","_disabled","asObservable","_fields","createPrunedFields","_model","addField","fieldsService","model","removeField","unsetField","replaceField","removeControl","formControl","updateField","original","modified","pruned","createPrunedField","convertField","convertFields","createDesignerFields","prunedFields","keys","getWrappers","clonedField","isFunction","designerConfig","filterWrapper","filter","w","typeWrappers","templateManipulators","preWrapper","map","postWrapper","j","splice","className","designerType","toString","r","_1","isEmpty","applyProperties","fieldGroupClassName","trim","designerWrapperFields","reduce","previous","current","designed","defaultValue","l","replaceFieldArray","buildPath","arrayNext","control","includeSelf","child","parent_1","FormGroup","controls","FormArray","at","unset","removeAt","BehaviorSubject","FormlyDesignerFieldWrapperComponent","ngOnInit","getOwnPropertyNames","fieldWrappers","formlyDesignerService","ngAfterContentInit","zone","runOutsideAngular","setTimeout","checkDesigner","ngAfterContentChecked","disabled","addWrapper","removeWrapper","index","edit","editing","fieldEdit","setValue","remove","accept","timer","subscribe","cancel","element","elementRef","parentNode","designerEmpty","querySelector","classList","contains","changeDetector","detectChanges","add","ChangeDetectorRef","ElementRef","NgZone","_super","FormControl","FormlyDesignerFieldGroupWrapperComponent","$fieldArray","onFieldSelected","updatedField","pipe","tap","catchError","NEVER","TemplateDesigner","isNonDesignerField","run","fc","fieldComponents","wrapperComponents","component","manipulators","class","method","FormlyDesignerComponent","form","formBuilder","group","subscriptions","fields$","fieldsChange","emit","merge","model$","valueChanges","debounceTime","modelChange","ngOnDestroy","subscription","unsubscribe","encapsulation","ViewEncapsulation","None","providers","FormBuilder","Output","Input","EventEmitter","properties","debugFields","FIELD_EDITOR_CONTROL_VALUE_ACCESSOR","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","FieldEditorComponent","multi","onTypeChange","statusChanges","invalid","subscribeValueChanges","valueChangesSubscription","writeValue","obj","markAsPristine","markAsUntouched","registerOnChange","fn","onChange","registerOnTouched","onTouched","setDisabledState","isDisabled","disable","enable","fieldForm","updateValue","fb","assign","onWrappersSelected","validator","hasType","result","showType","conflict","_","FieldPickerComponent","$","modalRef","nativeElement","$modal","modal","onApply","selected","Validators","compose","required","pattern","TYPE_SELECT_CONTROL_VALUE_ACCESSOR","TypeSelectComponent","ngAfterViewInit","WRAPPER_EDITOR_CONTROL_VALUE_ACCESSOR","WrapperEditorComponent","switchMap","ngOnChanges","changes","WRAPPER_SELECT_CONTROL_VALUE_ACCESSOR","WrapperSelectComponent","WrapperPickerComponent","WrappersPickerComponent","currentValue","onWrapperSelected","fieldWrappersIndex","indexOf","decycle","nextId","objects","traverse","v","has","id","$id","$ref","traverseValue","bind","replacement","DecyclePipe","transform","Pipe","FormlyDesignerModule","forRoot","ngModule","ANALYZE_FOR_ENTRY_COMPONENTS","useValue","NgModule","declarations","imports","CommonModule","FormsModule","ReactiveFormsModule","FormlyModule","forChild","exports","entryComponents","FormlyForm"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Component, ViewChild, ViewContainerRef } from '@angular/core';\nimport { FieldWrapper } from '@ngx-formly/core';\n\n@Component({\n    selector: 'formly-designer-wrapper',\n    template: `\n        <ng-template #fieldComponent></ng-template>\n    `\n})\nexport class FormlyDesignerWrapperComponent extends FieldWrapper {\n    @ViewChild('fieldComponent', { read: ViewContainerRef }) fieldComponent: ViewContainerRef;\n}\n","import { Injectable, Inject, InjectionToken } from '@angular/core';\nimport { FormlyConfig, FormlyFieldConfig } from '@ngx-formly/core';\n\nexport const FORMLY_DESIGNER_CONFIG_TOKEN = new InjectionToken<string>('FORMLY_DESIGNER_CONFIG_TOKEN');\n\n@Injectable()\nexport class FormlyDesignerConfig {\n    constructor(\n        @Inject(FORMLY_DESIGNER_CONFIG_TOKEN) configs: DesignerConfigOption[] = [],\n        private formlyConfig: FormlyConfig\n    ) {\n        configs.forEach(config => this.addConfig(config));\n    }\n\n    types: {[name: string]: DesignerTypeOption} = {};\n    wrappers: {[name: string]: DesignerOption} = {};\n    settings: DesignerSettings = { showClassName: true };\n\n    addConfig(config: DesignerConfigOption): void {\n        if (config.settings) {\n            this.setSettings(config.settings);\n        }\n        if (config.types) {\n            this.setType(config.types);\n        }\n        if (config.wrappers) {\n            this.setWrapper(config.wrappers);\n        }\n    }\n\n    setSettings(settings: DesignerSettings): void {\n        if (settings.showClassName !== undefined) {\n            this.settings.showClassName = !!settings.showClassName;\n        }\n    }\n\n    setType(options: DesignerTypeOption | DesignerTypeOption[]): void {\n        if (Array.isArray(options)) {\n            options.forEach((option) => {\n                this.setType(option);\n            });\n        } else {\n            // Throw if type isn't part of the formly config\n            this.formlyConfig.getType(options.name);\n\n            if (!this.types[options.name]) {\n                this.types[options.name] = <DesignerTypeOption>{};\n            }\n\n            const type = this.types[options.name];\n            type.name = options.name;\n            type.fieldArray = !!options.fieldArray;\n            type.fieldGroup = !!options.fieldGroup;\n            type.fields = options.fields;\n        }\n    }\n\n    setWrapper(options: DesignerOption | DesignerOption[]): void {\n        if (Array.isArray(options)) {\n            options.forEach((option) => {\n                this.setWrapper(option);\n            });\n        } else {\n            // Throw if wrapper isn't part of the formly config\n            this.formlyConfig.getWrapper(options.name);\n\n            if (!this.wrappers[options.name]) {\n                this.wrappers[options.name] = <DesignerOption>{};\n            }\n\n            const wrapper = this.wrappers[options.name];\n            wrapper.name = options.name;\n            wrapper.fields = options.fields;\n        }\n    }\n}\n\nexport interface DesignerOption {\n    name: string;\n    fields?: FormlyFieldConfig[];\n}\n\nexport interface DesignerTypeOption extends DesignerOption {\n    fieldArray?: boolean;\n    fieldGroup?: boolean;\n}\n\nexport interface DesignerSettings {\n    showClassName?: boolean;\n    filterWrapper?: (wrapper: string, field: FormlyFieldConfig) => boolean;\n}\n\nexport interface DesignerConfigOption {\n    settings?: DesignerSettings;\n    types?: DesignerTypeOption[];\n    wrappers?: DesignerOption[];\n}\n","import { FormlyFieldConfig } from '@ngx-formly/core';\n\nexport { cloneDeep, get, set, unset } from 'lodash-es';\n\nconst keyPathMemberName = '_formlyDesignerKeyPath';\n\n// Source: https://github.com/formly-js/ngx-formly/blob/master/src/core/src/lib/utils.ts\nexport function getKeyPath(field: { key?: string | string[], fieldGroup?: any, fieldArray?: any }): (string | number)[] {\n    /* We store the keyPath in the field for performance reasons. This function will be called frequently. */\n    if (!(<any>field)[keyPathMemberName] || (<any>field)[keyPathMemberName].key !== field.key) {\n        let keyPath: (string | number)[] = [];\n        if (field.key) {\n            /* Also allow for an array key, hence the type check  */\n            const pathElements = typeof field.key === 'string' ? field.key.split('.') : field.key;\n            for (let pathElement of pathElements) {\n                if (typeof pathElement === 'string') {\n                    /* replace paths of the form names[2] by names.2, cfr. angular formly */\n                    pathElement = pathElement.replace(/\\[(\\w+)\\]/g, '.$1');\n                    keyPath = keyPath.concat(pathElement.split('.'));\n                } else {\n                    keyPath.push(pathElement);\n                }\n            }\n            for (let i = 0; i < keyPath.length; i++) {\n                const pathElement = keyPath[i];\n                if (typeof pathElement === 'string' && /^\\d+$/.test(pathElement)) {\n                    keyPath[i] = parseInt(pathElement, 10);\n                }\n            }\n        }\n        (<any>field)[keyPathMemberName] = {\n            key: field.key,\n            path: keyPath,\n        };\n    }\n\n    return (<any>field)[keyPathMemberName].path.slice();\n}\n\n\nexport function equalType(a: FormlyFieldConfig, b: FormlyFieldConfig): boolean {\n    return (!a.fieldArray === !b.fieldArray) && (!a.fieldGroup === !b.fieldGroup);\n}\n\nexport function traverseFields(fields: FormlyFieldConfig[],\n    callback: (field: FormlyFieldConfig, path?: (string | number)[], parent?: FormlyFieldConfig) => boolean | any,\n    path?: (string | number)[],\n    parent?: FormlyFieldConfig): boolean | any {\n    path = path || [];\n    for (const field of fields) {\n        if (callback(field, path, parent)) {\n            return true;\n        }\n        if (field.fieldArray) {\n            if (traverseFields([field.fieldArray], callback, path.concat(getKeyPath(field)), field)) {\n                return true;\n            }\n        } else if (field.fieldGroup) {\n            if (traverseFields(field.fieldGroup, callback, path.concat(getKeyPath(field)), field)) {\n                return true;\n            }\n        }\n    }\n}\n\n// https://stackoverflow.com/a/40294058\n// export const cloneDeep = (obj, hash = new WeakMap()): typeof obj => {\n//   if (Object(obj) !== obj) return obj; // primitives\n//   if (hash.has(obj)) return hash.get(obj); // cyclic reference\n//   const result = obj instanceof Date ? new Date(obj)\n//     : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\n//       : obj.constructor ? new obj.constructor()\n//         : Object.create(null);\n//   hash.set(obj, result);\n//   if (obj instanceof Map)\n//     Array.from(obj, ([key, val]) => result.set(key, cloneDeep(val, hash)));\n//   return Object.assign(result, ...Object.keys(obj).map(\n//     key => ({ [key]: cloneDeep(obj[key], hash) })));\n// };\n\nexport const isArray = Array.isArray;\n\n\n// https://stackoverflow.com/a/28953167\nexport const isEmpty = (val: any): boolean => {\n    if (val === undefined)\n        return true;\n\n    else if (typeof (val) === 'function' || typeof (val) === 'number' || typeof (val) === 'boolean'\n        || Object.prototype.toString.call(val) === '[object Date]')\n        return false;\n\n    else if (val == null || val.length === 0)        // null or 0 length array\n        return true;\n\n    else if (typeof (val) === 'object') {\n        // empty object\n\n        let r;\n\n        for (const _ in val)\n            r = false;\n\n        return r;\n    }\n\n    return false;\n};\n\nexport const isFunction = (val: any): boolean => typeof val === 'function';\n\nexport const isObject = (val: any): boolean => typeof val === 'object' && val != null;\n\nexport const isString = (val: any): boolean => typeof val === 'string' || val instanceof String;\n","import { Injectable } from '@angular/core';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { DesignerOption, FormlyDesignerConfig } from './formly-designer-config';\nimport { cloneDeep, equalType, getKeyPath, isObject, traverseFields } from './util';\n\n@Injectable()\nexport class FieldsService {\n    constructor(\n        private formlyDesignerConfig: FormlyDesignerConfig\n    ) { }\n\n    getFullKeyPath(field: FormlyFieldConfig, fields: FormlyFieldConfig[]): (string | number)[] {\n        let keyPath = [];\n        if (field && field.key) {\n            const parents = new Map<FormlyFieldConfig, FormlyFieldConfig>();\n            traverseFields(fields, (f, path, parent) => {\n                parents.set(f, parent);\n            });\n\n            keyPath = getKeyPath(field);\n            let cur = parents.get(field);\n            while (cur) {\n                keyPath = getKeyPath(cur).concat(keyPath);\n                cur = parents.get(cur);\n            }\n        }\n        return keyPath;\n    }\n\n    getTypeFields(type: string): FormlyFieldConfig[] {\n        return this.getFields(type, 'type');\n    }\n\n    getWrapperFields(wrapper: string): FormlyFieldConfig[] {\n        return this.getFields(wrapper, 'wrapper');\n    }\n\n    /** Check the field for control type conflict */\n    checkField(field: FormlyFieldConfig, fields: FormlyFieldConfig[], parent?: FormlyFieldConfig): boolean {\n        const fullPathByField = new Map<FormlyFieldConfig, (string | number)[]>();\n\n        const newPath = this.getFullKeyPath(parent || {}, fields).concat(getKeyPath(field));\n        const length = newPath.length;\n        return !traverseFields(fields, (f, p) => {\n            const path = fullPathByField.get(f) || fullPathByField.set(f, (p || []).concat(getKeyPath(f))).get(f);\n            if (path.length !== length) {\n                return;\n            }\n            for (let i = 0; i < length; i++) {\n                if (path[i] !== newPath[i]) {\n                    return;\n                }\n            }\n            return !equalType(field, f);\n        });\n    }\n\n    mutateField(field: FormlyFieldConfig, designerField: boolean): FormlyFieldConfig {\n        if (isObject(field.templateOptions)) {\n            field.templateOptions['$designerField'] = designerField;\n        } else {\n            field.templateOptions = { $designerField: designerField };\n        }\n        if (field.fieldGroup) {\n            this.mutateFields(field.fieldGroup, designerField);\n        } else if (field.fieldArray && field.fieldArray.fieldGroup) {\n            if (designerField) {\n                this.mutateField(field.fieldArray, designerField);\n            } else {\n                // Treating fieldArrays as fieldGroups\n                field.templateOptions['$fieldArray'] = { type: field.type };\n                field.fieldGroup = field.fieldArray.fieldGroup;\n                delete field.fieldArray;\n                delete field.type;\n\n                this.mutateFields(field.fieldGroup, designerField);\n            }\n        }\n        return field;\n    }\n\n    mutateFields(fields: FormlyFieldConfig[], designerFields: boolean): void {\n        fields.forEach(field => this.mutateField(field, designerFields));\n    }\n\n    private getFields(name: string, type: string): FormlyFieldConfig[] {\n        const designerOption = (name ? this.getDesignerOptions(type)[name] || {} : {}) as DesignerOption;\n        const fields = cloneDeep(designerOption.fields || []);\n        this.mutateFields(fields, true);\n        return fields;\n    }\n\n    private getDesignerOptions(type: string): { [name: string]: DesignerOption } {\n        if (type === 'type') {\n            return this.formlyDesignerConfig.types;\n        }\n        if (type === 'wrapper') {\n            return this.formlyDesignerConfig.wrappers;\n        }\n        return {};\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { AbstractControl, FormArray, FormGroup } from '@angular/forms';\nimport { FieldsService } from './fields.service';\nimport { FormlyConfig, FormlyFieldConfig } from '@ngx-formly/core';\nimport { FormlyDesignerConfig } from './formly-designer-config';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { cloneDeep, get, isArray, isEmpty, isFunction, isString, set, unset } from './util';\n\n@Injectable()\nexport class FormlyDesignerService {\n  constructor(\n    private designerConfig: FormlyDesignerConfig,\n    private fieldsService: FieldsService,\n    private formlyConfig: FormlyConfig\n  ) { }\n\n  private readonly _disabled = new BehaviorSubject<boolean>(false);\n  private readonly _fields = new BehaviorSubject<FormlyFieldConfig[]>([]);\n  private readonly _model = new BehaviorSubject<any>({});\n\n  get disabled(): boolean {\n    return this._disabled.value;\n  }\n\n  set disabled(value: boolean) {\n    this._disabled.next(!!value);\n  }\n\n  get disabled$(): Observable<boolean> {\n    return this._disabled.asObservable();\n  }\n\n  get fields(): FormlyFieldConfig[] {\n    return this._fields.value;\n  }\n\n  set fields(value: FormlyFieldConfig[]) {\n    // Prune the fields because ngx-formly pollutes them with internal state\n    // causing incorrect behavior when re-applied.\n    const fields = this.createPrunedFields(isArray(value) ? value : []);\n    this._fields.next(fields);\n  }\n\n  get fields$(): Observable<FormlyFieldConfig[]> {\n    return this._fields.asObservable();\n  }\n\n  get model(): any {\n    return this._model.value;\n  }\n\n  set model(value: any) {\n    this._model.next(value == null ? {} : value);\n  }\n\n  get model$(): Observable<any> {\n    return this._model.asObservable();\n  }\n\n  addField(field: FormlyFieldConfig): void {\n    this.fieldsService.mutateField(field, false);\n\n    const fields = cloneDeep(this.fields);\n    fields.push(field);\n\n    this.fields = fields;\n    this.model = cloneDeep(this.model);\n  }\n\n  removeField(field: FormlyFieldConfig): void {\n    this.unsetField(field);\n    if (this.replaceField(this.fields, field, undefined)) {\n      this.removeControl(field.formControl);\n    }\n\n    this.fields = cloneDeep(this.fields);\n    this.model = cloneDeep(this.model);\n  }\n\n  updateField(original: FormlyFieldConfig, modified: FormlyFieldConfig): void {\n    const pruned = this.fieldsService.mutateField(this.createPrunedField(modified), false);\n\n    if (this.replaceField(this.fields, original, pruned)) {\n      if (original.formControl !== pruned.formControl) {\n        this.unsetField(original);\n        this.removeControl(original.formControl);\n      }\n\n      this.fields = cloneDeep(this.fields);\n      this.model = cloneDeep(this.model);\n    }\n  }\n\n  convertField(field: FormlyFieldConfig): FormlyFieldConfig {\n    return this.createPrunedField(field);\n  }\n\n  convertFields(fields: FormlyFieldConfig[]): FormlyFieldConfig[] {\n    return this.createPrunedFields(fields);\n  }\n\n  createDesignerFields(): FormlyFieldConfig[] {\n    return this.createPrunedFields(this.fields);\n  }\n\n  private createPrunedFields(fields: FormlyFieldConfig[]): FormlyFieldConfig[] {\n    const prunedFields: FormlyFieldConfig[] = [];\n    if (isArray(fields)) {\n      fields.forEach(field => {\n        const pruned = this.createPrunedField(field);\n        if (field.fieldArray) {\n          pruned.fieldArray = this.createPrunedField(field.fieldArray);\n        } else if (field.fieldGroup && !pruned.fieldArray) {\n          pruned.fieldGroup = this.createPrunedFields(field.fieldGroup);\n        }\n        if (Object.keys(pruned).length > 0) {\n          prunedFields.push(pruned);\n        }\n      });\n    }\n    return prunedFields;\n  }\n\n  getWrappers(field: FormlyFieldConfig): string[] {\n    if (!field || !isArray(field.wrappers)) {\n      return [];\n    }\n\n    const clonedField = cloneDeep(field);\n    let wrappers = clonedField.wrappers = (clonedField.wrappers || []);\n    if (isFunction(this.designerConfig.settings.filterWrapper)) {\n      wrappers = wrappers.filter(w => this.designerConfig.settings.filterWrapper(w, clonedField));\n    }\n\n    // Determine wrappers part of the formly configuration (static and dynamic) to exclude them from the result\n    const staticWrappers = field.type ? this.formlyConfig.getType(field.type).wrappers || [] : [];\n    const typeWrappers = staticWrappers\n      .concat(this.formlyConfig.templateManipulators.preWrapper.map(m => m(clonedField)))\n      .concat(this.formlyConfig.templateManipulators.postWrapper.map(m => m(clonedField)))\n      .filter(w => w);\n\n    // Remove wrappers part of the formly configuration from the result\n    if (typeWrappers.length > 0) {\n      for (let i = wrappers.length - 1; i >= 0; i--) {\n        for (let j = typeWrappers.length - 1; j >= 0; j--) {\n          if (wrappers[i] === typeWrappers[j]) {\n            typeWrappers.splice(j, 1);\n            wrappers.splice(i, 1);\n            break;\n          }\n        }\n      }\n    }\n    return wrappers;\n  }\n\n  /** Prunes the field of paths not identified in the designer config */\n  private createPrunedField(field: FormlyFieldConfig): FormlyFieldConfig {\n    const type = get(field, 'templateOptions.$fieldArray.type', field.type);\n    const designerType = this.designerConfig.types[type];\n    const pruned: FormlyFieldConfig = isEmpty(field.key) ? {} : { key: field.key };\n\n    if (designerType) {\n      pruned.type = type;\n      this.applyProperties(field, pruned, designerType.fields);\n      if (designerType.fieldArray) {\n        pruned.fieldArray = {\n          fieldGroup: this.createPrunedFields(field.fieldGroup)\n        };\n      }\n    }\n\n    if (isArray(field.fieldGroup) && !isArray(pruned.fieldArray)) {\n      pruned.fieldGroup = this.createPrunedFields(field.fieldGroup);\n\n      let fieldGroupClassName: string;\n      if (isString(field.fieldGroupClassName) && (fieldGroupClassName = field.fieldGroupClassName.trim()).length > 0) {\n        pruned.fieldGroupClassName = fieldGroupClassName;\n      }\n    }\n\n    let className: string;\n    if (isString(field.className) && (className = field.className.trim()).length > 0) {\n      pruned.className = className;\n    }\n\n    const wrappers = this.getWrappers(field);\n    if (wrappers.length > 0) {\n      pruned.wrappers = wrappers;\n      const designerWrapperFields = wrappers.map(wrapper => this.designerConfig.wrappers[wrapper])\n        .filter(designerOption => designerOption && isArray(designerOption.fields))\n        .reduce<FormlyFieldConfig[]>((previous, current) => previous.concat(current.fields), []);\n      this.applyProperties(field, pruned, designerWrapperFields);\n    }\n    return pruned;\n  }\n\n  private applyProperties(field: FormlyFieldConfig, designed: FormlyFieldConfig, designerFields: FormlyFieldConfig[]): void {\n    if (isArray(designerFields)) {\n      designerFields.forEach(designerField => {\n        const value = get(field, designerField.key);\n        if (value != null && (!isString(value) || value.length > 0) && value !== designerField.defaultValue) {\n          set(designed, designerField.key, value);\n        }\n      });\n    }\n  }\n\n  private replaceField(fields: FormlyFieldConfig[], original: FormlyFieldConfig, modified: FormlyFieldConfig): boolean {\n    if (isArray(fields)) {\n      const l = fields.length;\n      for (let i = 0; i < l; i++) {\n        const field = fields[i];\n        if (field === original) {\n          if (modified == null) {\n            fields.splice(i, 1);\n          } else {\n            fields[i] = modified;\n          }\n          return true;\n        }\n        if (field.fieldGroup && this.replaceField(field.fieldGroup, original, modified)) {\n          return true;\n        }\n        if (field.fieldArray && this.replaceFieldArray(field, original, modified)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  private replaceFieldArray(parent: FormlyFieldConfig, original: FormlyFieldConfig, modified: FormlyFieldConfig): boolean {\n    const fieldArray = parent.fieldArray;\n    if (fieldArray === original) {\n      parent.fieldArray = modified;\n      return true;\n    }\n    if (fieldArray.fieldGroup && this.replaceField(fieldArray.fieldGroup, original, modified)) {\n      return true;\n    }\n    return fieldArray.fieldArray && this.replaceFieldArray(fieldArray, original, modified);\n  }\n\n  private buildPath(key: string, path: string, arrayNext: boolean = false) {\n    return path ? key + (arrayNext ? path : '.' + path) : key;\n  }\n\n  private path(control: AbstractControl, includeSelf: boolean = true): string {\n    let path = '';\n    let arrayNext = false;\n\n    if (!includeSelf) {\n      control = (control || {} as AbstractControl).parent;\n    }\n    for (let child = control, parent = (control || {} as AbstractControl).parent; !!parent; child = parent, parent = parent.parent) {\n      if (parent instanceof FormGroup) {\n        for (const key in parent.controls) {\n          if (parent.controls[key] === child) {\n            path = this.buildPath(key, path, arrayNext);\n            arrayNext = false;\n            break;\n          }\n        }\n      } else if (parent instanceof FormArray) {\n        for (let i = 0; i < parent.length; i++) {\n          if (parent.at(i) === child) {\n            path = this.buildPath('[' + i + ']', path, arrayNext);\n            arrayNext = true;\n            break;\n          }\n        }\n      }\n    }\n    return path;\n  }\n\n  private unsetField(field: FormlyFieldConfig): void {\n    if (field) {\n      if (field.fieldArray) {\n        this.unsetField(field.fieldArray);\n      }\n      if (field.fieldGroup) {\n        field.fieldGroup.forEach(f => this.unsetField(f));\n      }\n      if (field.formControl) {\n        const path = this.path(field.formControl);\n        unset(this.model, path);\n      }\n    }\n  }\n\n  private removeControl(control: AbstractControl): void {\n    const parent = control ? control.parent : undefined;\n    if (parent instanceof FormGroup) {\n      for (const key in parent.controls) {\n        if (parent.controls[key] === control) {\n          parent.removeControl(key);\n          return;\n        }\n      }\n    } else if (parent instanceof FormArray) {\n      for (let i = 0; i < parent.length; i++) {\n        if (parent.at(i) === control) {\n          parent.removeAt(i);\n          return;\n        }\n      }\n    }\n  }\n}\n","import { AfterContentChecked, AfterContentInit, ChangeDetectorRef, Component, ElementRef,\n    NgZone, OnInit, ViewChild, ViewContainerRef } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { FieldWrapper } from '@ngx-formly/core';\nimport { FieldsService } from '../fields.service';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { FormlyDesignerService } from '../formly-designer.service';\nimport { cloneDeep } from '../util';\nimport { timer } from 'rxjs';\n\n@Component({\n    selector: 'formly-designer-field-wrapper',\n    template: `\n        <div *ngIf=\"!editing\" class=\"bg-info text-white control-panel\">\n            <span class=\"type\">{{ type }}</span>\n            <div class=\"btn-group\">\n                <button type=\"button\" class=\"btn\" data-toggle=\"dropdown\"\n                    aria-haspopup=\"true\" aria-expanded=\"false\" title=\"wrappers\">\n                    <i class=\"fa fa-clone\" aria-hidden=\"true\"></i>\n                </button>\n                <div class=\"dropdown-menu dropdown-menu-right\">\n                    <button class=\"dropdown-item\" type=\"button\" [disabled]=\"disabled\" title=\"add wrapper\"\n                        *ngFor=\"let wrapper of wrappers\" (click)=\"addWrapper(wrapper)\">\n                        {{ wrapper }}\n                    </button>\n                    <ng-container *ngIf=\"fieldWrappers.length\">\n                        <div *ngIf=\"wrappers.length\" class=\"dropdown-divider\"></div>\n                        <button class=\"dropdown-item\" type=\"button\" [disabled]=\"disabled\"\n                            *ngFor=\"let wrapper of fieldWrappers; let i=index\" (click)=\"removeWrapper(i)\">\n                            {{ wrapper }}&nbsp;&nbsp;<i class=\"fa fa-times\" aria-hidden=\"true\" title=\"remove wrapper\"></i>\n                        </button>\n                    </ng-container>\n                </div>\n            </div>\n            <button class=\"btn\" type=\"button\" [disabled]=\"disabled\" (click)=\"edit()\">\n                <i class=\"fa fa-pencil\" aria-hidden=\"true\" title=\"edit\"></i>\n            </button>\n            <button class=\"btn\" type=\"button\" [disabled]=\"disabled\" (click)=\"remove()\">\n                <i class=\"fa fa-times\" aria-hidden=\"true\" title=\"remove\"></i>\n            </button>\n        </div>\n        <div class=\"content\">\n            <div class=\"editor\" [hidden]=\"!editing\">\n                <formly-designer-field-editor #editor [hasContent]=\"true\" [showType]=\"true\" [showWrappers]=\"true\" [formControl]=\"fieldEdit\">\n                    <div class=\"footer\">\n                        <button (click)=\"cancel()\" class=\"btn btn-secondary mr-1\">Cancel</button>\n                        <button [disabled]=\"editor.invalid\" (click)=\"accept()\" class=\"btn btn-primary\">Apply</button>\n                    </div>\n                </formly-designer-field-editor>\n            </div>\n            <div [hidden]=\"editing\">\n                <ng-template #fieldComponent></ng-template>\n            </div>\n        </div>\n    `,\n    styles: [`\n        :host {\n            display: flex;\n            position: relative;\n            justify-content: flex-start;\n            align-content: flex-start;\n            align-items: flex-start;\n            margin: .25em;\n        }\n        :host.designerEmpty {\n            display:none;\n        }\n        .btn:not(:disabled), .dropdown-item:not(:disabled) {\n            cursor: pointer;\n        }\n        .control-panel {\n            font-size: .8em;\n            position: absolute;\n            padding: 0 0 0 .5em;\n            border-radius: 0 5px 0 0;\n            right: 0;\n            top: 0;\n        }\n        .control-panel > * {\n            padding-right: .5em;\n        }\n        .control-panel .btn {\n            font-size: unset;\n            background-color: unset;\n            padding: 0 .5em 0 0;\n            color: #fff;\n        }\n        .content {\n            border: 1px dashed #000;\n            border-radius: 5px;\n            min-height: 2em;\n            padding: 1.5em 1em 0 1em;\n            width: 100%;\n        }\n        .content:first-child {\n            padding-top: 0;\n        }\n        .editor {\n            margin: 1em 0;\n        }\n        .footer {\n            display: flex;\n            justify-content: flex-end;\n        }\n    `]\n})\nexport class FormlyDesignerFieldWrapperComponent extends FieldWrapper\n    implements AfterContentInit, AfterContentChecked, OnInit {\n    @ViewChild('fieldComponent', { read: ViewContainerRef }) fieldComponent: ViewContainerRef;\n\n    editing = false;\n    fieldEdit = new FormControl({});\n    fieldWrappers: string[] = [];\n    wrappers: string[] = [];\n    type: string;\n\n    constructor(\n        private changeDetector: ChangeDetectorRef,\n        private designerConfig: FormlyDesignerConfig,\n        private elementRef: ElementRef,\n        private fieldsService: FieldsService,\n        private formlyDesignerService: FormlyDesignerService,\n        private zone: NgZone\n    ) {\n        super();\n    }\n\n    ngOnInit(): void {\n        this.type = this.field.type;\n        this.wrappers = Object.getOwnPropertyNames(this.designerConfig.wrappers);\n        this.fieldWrappers = this.formlyDesignerService.getWrappers(this.formlyDesignerService.convertField(this.field)) || [];\n    }\n\n    ngAfterContentInit(): void {\n        this.zone.runOutsideAngular(() => setTimeout(() => this.checkDesigner()));\n    }\n\n    ngAfterContentChecked(): void {\n        this.zone.runOutsideAngular(() => setTimeout(() => this.checkDesigner()));\n    }\n\n    get disabled(): boolean {\n        return this.formlyDesignerService.disabled;\n    }\n\n    addWrapper(wrapper: string): void {\n        const field = cloneDeep(this.field);\n        if (field.wrappers) {\n            field.wrappers.push(wrapper);\n        } else {\n            field.wrappers = [wrapper];\n        }\n        this.formlyDesignerService.updateField(this.field, field);\n    }\n\n    removeWrapper(index: number): void {\n        const field = cloneDeep(this.field);\n        this.fieldWrappers.splice(index, 1);\n        field.wrappers = this.fieldWrappers;\n        this.formlyDesignerService.updateField(this.field, field);\n    }\n\n    edit(): void {\n        this.editing = true;\n        this.formlyDesignerService.disabled = true;\n        this.fieldEdit.setValue(this.formlyDesignerService.convertField(cloneDeep(this.field)));\n    }\n\n    remove(): void {\n        this.formlyDesignerService.removeField(this.field);\n    }\n\n    accept(): void {\n        if (!this.fieldsService.checkField(this.fieldEdit.value, this.formlyDesignerService.fields)) {\n            return;\n        }\n        timer().subscribe(() => {\n            this.formlyDesignerService.updateField(this.field, this.fieldEdit.value);\n            this.formlyDesignerService.disabled = false;\n            this.editing = false;\n        });\n    }\n\n    cancel(): void {\n        this.formlyDesignerService.disabled = false;\n        this.editing = false;\n    }\n\n    private checkDesigner(): void {\n        const element = this.elementRef.nativeElement as HTMLElement;\n        if (element.parentNode == null) {\n            return;\n        }\n\n        const designerEmpty = element.querySelector('formly-designer-wrapper') == null;\n        if (designerEmpty !== element.classList.contains('designerEmpty')) {\n            this.changeDetector.detectChanges();\n            if (designerEmpty) {\n                element.classList.add('designerEmpty');\n            } else {\n                element.classList.remove('designerEmpty');\n            }\n        }\n    }\n}\n","import { AfterContentChecked, AfterContentInit, ChangeDetectorRef, Component, ElementRef,\n    NgZone, OnInit, ViewChild, ViewContainerRef } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { FieldWrapper, FormlyFieldConfig } from '@ngx-formly/core';\nimport { FieldsService } from '../fields.service';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { FormlyDesignerService } from '../formly-designer.service';\nimport { cloneDeep, isArray } from '../util';\nimport { NEVER, timer } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\n\n@Component({\n    selector: 'formly-designer-field-group-wrapper',\n    template: `\n        <div *ngIf=\"!editing\" class=\"bg-info text-white control-panel\">\n            <span class=\"type\">{{ type }}</span>\n            <div class=\"btn-group\">\n                <button type=\"button\" class=\"btn\" data-toggle=\"dropdown\"\n                    aria-haspopup=\"true\" aria-expanded=\"false\" title=\"wrappers\">\n                    <i class=\"fa fa-clone\" aria-hidden=\"true\"></i>\n                </button>\n                <div class=\"dropdown-menu dropdown-menu-right\">\n                    <button class=\"dropdown-item\" type=\"button\" [disabled]=\"disabled\" title=\"add wrapper\"\n                        *ngFor=\"let wrapper of wrappers\" (click)=\"addWrapper(wrapper)\">\n                        {{ wrapper }}\n                    </button>\n                    <ng-container *ngIf=\"fieldWrappers.length\">\n                        <div *ngIf=\"wrappers.length\" class=\"dropdown-divider\"></div>\n                        <button class=\"dropdown-item\" type=\"button\" [disabled]=\"disabled\"\n                            *ngFor=\"let wrapper of fieldWrappers; let i=index\" (click)=\"removeWrapper(i)\">\n                            {{ wrapper }}&nbsp;&nbsp;<i class=\"fa fa-times\" aria-hidden=\"true\" title=\"remove wrapper\"></i>\n                        </button>\n                    </ng-container>\n                </div>\n            </div>\n            <button [disabled]=\"disabled\" type=\"button\" class=\"btn\" (click)=\"edit()\">\n                <i class=\"fa fa-pencil\" aria-hidden=\"true\" title=\"edit\"></i>\n            </button>\n            <button [disabled]=\"disabled\" type=\"button\" class=\"btn\" (click)=\"remove()\">\n                <i class=\"fa fa-times\" aria-hidden=\"true\" title=\"remove\"></i>\n            </button>\n        </div>\n        <div class=\"content\">\n            <div [hidden]=\"!editing\">\n                <formly-designer-field-editor #editor [fieldGroup]=\"true\" [hasContent]=\"true\" [showWrappers]=\"true\"\n                    [formControl]=\"fieldEdit\">\n                    <div class=\"footer\">\n                        <button (click)=\"cancel()\" class=\"btn btn-secondary mr-1\">Cancel</button>\n                        <button [disabled]=\"editor.invalid\" (click)=\"accept()\" class=\"btn btn-primary\">Apply</button>\n                    </div>\n                </formly-designer-field-editor>\n            </div>\n            <div [hidden]=\"editing\">\n                <div class=\"form-group\">\n                    <label>child</label>\n                    <formly-designer-field-picker (selected)=\"onFieldSelected($event)\"></formly-designer-field-picker>\n                </div>\n                <ng-template #fieldComponent></ng-template>\n            </div>\n        </div>\n    `,\n    styles: [`\n        :host {\n            display: flex;\n            position: relative;\n            justify-content: flex-start;\n            align-content: flex-start;\n            align-items: flex-start;\n            margin: .25em;\n        }\n        :host.designerEmpty {\n            display:none;\n        }\n        .btn:not(:disabled), .dropdown-item:not(:disabled) {\n            cursor: pointer;\n        }\n        .control-panel {\n            font-size: .8em;\n            position: absolute;\n            padding: 0 0 0 .5em;\n            border-radius: 0 5px 0 0;\n            right: 0;\n            top: 0;\n        }\n        .control-panel > * {\n            padding-right: .5em;\n        }\n        .control-panel .btn {\n            font-size: unset;\n            background-color: unset;\n            padding: 0 .5em 0 0;\n            color: #fff;\n        }\n        .content {\n            border: 1px dashed #000;\n            border-radius: 5px;\n            padding: 1em;\n            width: 100%;\n        }\n        .footer {\n            display: flex;\n            justify-content: flex-end;\n        }\n    `]\n})\nexport class FormlyDesignerFieldGroupWrapperComponent extends FieldWrapper\n    implements AfterContentInit, AfterContentChecked, OnInit {\n    @ViewChild('fieldComponent', { read: ViewContainerRef }) fieldComponent: ViewContainerRef;\n\n    type: string;\n    editing = false;\n    fieldEdit = new FormControl({});\n    fieldWrappers: string[] = [];\n    wrappers: string[] = [];\n\n    constructor(\n        private changeDetector: ChangeDetectorRef,\n        private designerConfig: FormlyDesignerConfig,\n        private elementRef: ElementRef,\n        private fieldsService: FieldsService,\n        private formlyDesignerService: FormlyDesignerService,\n        private zone: NgZone\n    ) {\n        super();\n    }\n\n    ngOnInit(): void {\n        if (this.field.templateOptions.$fieldArray) {\n            this.type = this.field.templateOptions.$fieldArray.type || 'fieldArray';\n        } else if (this.field.type) {\n            this.type = this.field.type;\n        } else if (this.field.fieldGroup) {\n            this.type = 'fieldGroup';\n        }\n        this.wrappers = Object.getOwnPropertyNames(this.designerConfig.wrappers);\n        this.fieldWrappers = this.formlyDesignerService.convertField(this.field).wrappers || [];\n    }\n\n    ngAfterContentInit(): void {\n        this.zone.runOutsideAngular(() => setTimeout(() => this.checkDesigner()));\n    }\n\n    ngAfterContentChecked(): void {\n        this.zone.runOutsideAngular(() => setTimeout(() => this.checkDesigner()));\n    }\n\n    get disabled(): boolean {\n        return this.formlyDesignerService.disabled;\n    }\n\n    addWrapper(wrapper: string): void {\n        const field = cloneDeep(this.field);\n        if (field.wrappers) {\n            field.wrappers.push(wrapper);\n        } else {\n            field.wrappers = [wrapper];\n        }\n        this.formlyDesignerService.updateField(this.field, field);\n    }\n\n    removeWrapper(index: number): void {\n        const field = cloneDeep(this.field);\n        this.fieldWrappers.splice(index, 1);\n        field.wrappers = this.fieldWrappers;\n        this.formlyDesignerService.updateField(this.field, field);\n    }\n\n    edit(): void {\n        this.editing = true;\n        this.formlyDesignerService.disabled = true;\n        this.fieldEdit.setValue(this.formlyDesignerService.convertField(cloneDeep(this.field)));\n    }\n\n    remove(): void {\n        this.formlyDesignerService.removeField(this.field);\n    }\n\n    accept(): void {\n        if (!this.fieldsService.checkField(this.fieldEdit.value, this.formlyDesignerService.fields)) {\n            return;\n        }\n\n        timer().subscribe(() => {\n            this.formlyDesignerService.updateField(this.field, this.fieldEdit.value);\n            this.formlyDesignerService.disabled = false;\n            this.editing = false;\n        });\n    }\n\n    cancel(): void {\n        this.formlyDesignerService.disabled = false;\n        this.editing = false;\n    }\n\n    onFieldSelected(field: FormlyFieldConfig): void {\n        if (isArray(this.field.fieldGroup) &&\n            !this.fieldsService.checkField(field, this.formlyDesignerService.fields, this.field)) {\n            return;\n        }\n\n        const updatedField = cloneDeep(this.field);\n        updatedField.fieldGroup = isArray(updatedField.fieldGroup) ? updatedField.fieldGroup.slice() : [];\n        updatedField.fieldGroup.push(field);\n\n        timer()\n            .pipe(\n                tap(() => this.formlyDesignerService.updateField(this.field, updatedField)),\n                catchError(() => NEVER)\n            )\n            .subscribe();\n    }\n\n    private checkDesigner(): void {\n        const element = this.elementRef.nativeElement as HTMLElement;\n        if (element.parentNode == null) {\n            return;\n        }\n\n        const designerEmpty = element.querySelector('formly-designer-wrapper') == null;\n        if (designerEmpty !== element.classList.contains('designerEmpty')) {\n            this.changeDetector.detectChanges();\n            if (designerEmpty) {\n                element.classList.add('designerEmpty');\n            } else {\n                element.classList.remove('designerEmpty');\n            }\n        }\n    }\n}\n","import { FormlyFieldConfig, FormlyConfig } from '@ngx-formly/core';\n\nexport class TemplateDesigner {\n    private isNonDesignerField(field: FormlyFieldConfig): boolean {\n        return field && (!field.templateOptions || field.templateOptions['$designerField'] !== true);\n    }\n\n    run(fc: FormlyConfig) {\n        fc.templateManipulators.preWrapper.push((field: FormlyFieldConfig) => {\n            if (this.isNonDesignerField(field)) {\n                return field.fieldGroup ? 'fieldGroupDesigner' : 'fieldDesigner';\n            }\n        });\n        fc.templateManipulators.postWrapper.push((field: FormlyFieldConfig) => {\n            if (this.isNonDesignerField(field)) {\n                return 'designer';\n            }\n        });\n    }\n}\n","import { ConfigOption } from '@ngx-formly/core';\nimport { FormlyDesignerWrapperComponent } from './wrappers/designer';\nimport { FormlyDesignerFieldWrapperComponent } from './wrappers/field-designer';\nimport { FormlyDesignerFieldGroupWrapperComponent } from './wrappers/field-group-designer';\nimport { TemplateDesigner } from './run/designer';\n\nexport const fieldComponents = [];\n\nexport const wrapperComponents = [\n    FormlyDesignerWrapperComponent,\n    FormlyDesignerFieldWrapperComponent,\n    FormlyDesignerFieldGroupWrapperComponent\n];\n\nexport const config: ConfigOption = {\n    wrappers: [\n        { name: 'designer', component: FormlyDesignerWrapperComponent },\n        { name: 'fieldDesigner', component: FormlyDesignerFieldWrapperComponent },\n        { name: 'fieldGroupDesigner', component: FormlyDesignerFieldGroupWrapperComponent }\n    ],\n    manipulators: [\n        { class: TemplateDesigner, method: 'run' }\n    ]\n};\n","import { Component, EventEmitter, Input, OnDestroy, OnInit, Output, ViewChild, ViewContainerRef, ViewEncapsulation } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { FieldsService } from './fields.service';\nimport { FormlyDesignerService } from './formly-designer.service';\nimport { merge, NEVER, Subscription, timer } from 'rxjs';\nimport { catchError, debounceTime, tap } from 'rxjs/operators';\n\n@Component({\n    selector: 'formly-designer',\n    template: `\n        <formly-designer-field-picker (selected)=\"onFieldSelected($event)\">\n        </formly-designer-field-picker>\n        <form novalidate [formGroup]=\"form\">\n            <formly-form [options]=\"options\" [model]=\"model\" [form]=\"form\" [fields]=\"fields\">\n            </formly-form>\n        </form>\n        <!--<div>\n            Designer Fields Debug:\n            <pre>{{ fields | decycle | json }}</pre>\n        </div>-->\n    `,\n    styles: [`\n        formly-designer-field-picker .form-group > .input-group > formly-designer-type-select > select {\n            border-radius: .25rem 0 0 .25rem;\n            border-right: 0;\n        }\n        formly-designer-wrapper-editor .card > .card-body .form-control {\n            width: 100%;\n        }\n        formly-designer-wrapper-picker .form-group > .input-group > formly-designer-wrapper-select > select {\n            border-radius: .25rem 0 0 .25rem;\n            border-right: 0;\n        }\n    `],\n    encapsulation: ViewEncapsulation.None,\n    providers: [FormlyDesignerService]\n})\nexport class FormlyDesignerComponent implements OnDestroy, OnInit {\n    @ViewChild('formlyFormContainer', { read: ViewContainerRef }) formlyFormContainer;\n    @Output() fieldsChange = new EventEmitter<FormlyFieldConfig[]>();\n    @Output() modelChange = new EventEmitter<any>();\n\n    types: string[] = [];\n    wrappers: string[] = [];\n    properties: string[] = [];\n    debugFields: FormlyFieldConfig[] = [];\n\n    form: FormGroup;\n    options: any = {};\n\n    private readonly subscriptions: Subscription[] = [];\n\n    constructor(\n        private fieldsService: FieldsService,\n        private formBuilder: FormBuilder,\n        private formlyDesignerService: FormlyDesignerService\n    ) { }\n\n    @Input()\n    get disabled(): boolean {\n        return this.formlyDesignerService.disabled;\n    }\n\n    set disabled(value: boolean) {\n        this.formlyDesignerService.disabled = value;\n    }\n\n    @Input()\n    get fields(): FormlyFieldConfig[] {\n        return this.formlyDesignerService.fields;\n    }\n\n    set fields(value: FormlyFieldConfig[]) {\n        const fields = this.formlyDesignerService.convertFields(value);\n        this.fieldsService.mutateFields(fields, false);\n        this.formlyDesignerService.fields = fields;\n    }\n\n    @Input()\n    get model(): any {\n        return this.formlyDesignerService.model;\n    }\n\n    set model(value: any) {\n        this.formlyDesignerService.model = value;\n    }\n\n    ngOnInit(): void {\n        // Designer forms will be restricted to a single field depth; all designer keys should be\n        // complex (e.g. \"templateOptions.some.property\")\n        this.form = this.formBuilder.group({});\n\n        this.subscriptions.push(this.formlyDesignerService.fields$\n            .subscribe(() => {\n                this.form = this.formBuilder.group({});\n                this.fieldsChange.emit(this.formlyDesignerService.createDesignerFields());\n            }));\n\n        this.subscriptions.push(merge(\n            this.formlyDesignerService.model$,\n            this.form.valueChanges\n        )\n            .pipe(debounceTime(50))\n            .subscribe(() => this.modelChange.emit(this.formlyDesignerService.model)));\n    }\n\n    ngOnDestroy(): void {\n        this.subscriptions.splice(0).forEach(subscription => subscription.unsubscribe());\n    }\n\n    onFieldSelected(field: FormlyFieldConfig): void {\n        timer().pipe(\n            tap(() => {\n                if (this.fieldsService.checkField(field, this.formlyDesignerService.fields)) {\n                    this.formlyDesignerService.addField(field);\n                }\n            }),\n            catchError(() => NEVER)).subscribe();\n    }\n}\n","import { Component, ElementRef, forwardRef, Input, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { ControlValueAccessor, FormBuilder, FormControl, FormGroup, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { FieldsService } from '../fields.service';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { merge, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { cloneDeep, isArray, isObject, isString } from '../util';\n\nconst FIELD_EDITOR_CONTROL_VALUE_ACCESSOR: any = {\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => FieldEditorComponent),\n    multi: true\n};\n\n@Component({\n    selector: 'formly-designer-field-editor',\n    template: `\n        <form [formGroup]=\"form\" novalidate>\n            <div class=\"card\">\n                <div class=\"card-header\" [ngClass]=\"{solo: !hasContent && fields.length === 0}\">\n                    <div class=\"form-group\" [ngClass]=\"{'has-danger': form.hasError('key') && (key.dirty || key.touched)}\">\n                        <label class=\"form-control-label\">key</label>\n                        <input formControlName=\"key\" class=\"form-control\">\n                        <div *ngIf=\"form.hasError('key') && (key.dirty || key.touched)\" class=\"form-control-feedback\">\n                            key required.\n                        </div>\n                    </div>\n                    <div *ngIf=\"formlyDesignerConfig.settings.showClassName\" class=\"form-group\">\n                        <label class=\"form-control-label\">className</label>\n                        <input formControlName=\"className\" class=\"form-control\">\n                    </div>\n                    <div *ngIf=\"fieldGroup && formlyDesignerConfig.settings.showClassName\" class=\"form-group\">\n                        <label class=\"form-control-label\">fieldGroupClassName</label>\n                        <input formControlName=\"fieldGroupClassName\" class=\"form-control\">\n                    </div>\n                    <div *ngIf=\"showType\" class=\"form-group\"\n                        [ngClass]=\"{'has-danger': form.hasError('type') && (type.dirty || type.touched)}\">\n                        <label class=\"form-control-label\">type</label>\n                        <formly-designer-type-select formControlName=\"type\"></formly-designer-type-select>\n                        <div *ngIf=\"form.hasError('type') && (type.dirty || type.touched)\" class=\"form-control-feedback\">\n                            type required.\n                        </div>\n                    </div>\n                    <div *ngIf=\"showWrappers\" class=\"form-group\">\n                        <label class=\"form-control-label\">wrappers</label>\n                        <formly-designer-wrappers-picker [field]=\"field\"\n                            (selected)=\"onWrappersSelected($event)\">\n                        </formly-designer-wrappers-picker>\n                    </div>\n                </div>\n                <div #block class=\"card-body\">\n                    <formly-form *ngIf=\"fields.length > 0\" [form]=\"fieldForm\" [fields]=\"fields\" [model]=\"field\">\n                    </formly-form>\n                    <ng-content></ng-content>\n                </div>\n            </div>\n        </form>\n    `,\n    styles: [`\n        .card-header.solo {\n            border-bottom: 0;\n        }\n        .card-header.solo + .card-body {\n            display: none;\n        }\n    `],\n    providers: [\n        FIELD_EDITOR_CONTROL_VALUE_ACCESSOR\n    ]\n})\nexport class FieldEditorComponent implements ControlValueAccessor, OnDestroy, OnInit {\n    @Input() fieldGroup: boolean;\n    @Input() showType: boolean;\n    @Input() showWrappers: boolean;\n    @Input() hasContent: boolean;\n    @ViewChild('block') blockElRef: ElementRef;\n\n    private readonly subscriptions: Subscription[] = [];\n    private valueChangesSubscription: Subscription;\n\n    constructor(\n        private fieldsService: FieldsService,\n        private fb: FormBuilder,\n        public formlyDesignerConfig: FormlyDesignerConfig\n    ) {\n        this.form = fb.group({\n            key: this.key = fb.control(''),\n            className: this.className = fb.control(''),\n            fieldGroupClassName: this.fieldGroupClassName = fb.control(''),\n            type: this.type = fb.control('')\n        }, { validator: (control) => this.validator(control) });\n        this.fieldForm = fb.group({});\n    }\n\n    readonly form: FormGroup;\n    readonly key: FormControl;\n    readonly className: FormControl;\n    readonly fieldGroupClassName: FormControl;\n    readonly type: FormControl;\n\n    fieldForm: FormGroup;\n    field: FormlyFieldConfig = {};\n    fields: FormlyFieldConfig[] = [];\n    fieldArray: boolean;\n    invalid: boolean;\n\n    protected onChange = (_: any) => { };\n    protected onTouched = () => { };\n\n    ngOnInit(): void {\n        this.subscriptions.push(this.type.valueChanges\n            .subscribe(() => this.onTypeChange()));\n\n        this.subscriptions.push(this.form.statusChanges\n            .pipe(debounceTime(0))\n            .subscribe(() => this.invalid = this.form.invalid));\n\n        this.subscribeValueChanges();\n    }\n\n    ngOnDestroy(): void {\n        this.valueChangesSubscription.unsubscribe();\n        this.subscriptions.splice(0).forEach(subscription => subscription.unsubscribe());\n    }\n\n    writeValue(obj: any) {\n        this.valueChangesSubscription.unsubscribe();\n        this.updateField(obj);\n        this.form.markAsPristine();\n        this.form.markAsUntouched();\n        this.subscribeValueChanges();\n    }\n\n    registerOnChange(fn: any) {\n        this.onChange = fn;\n    }\n\n    registerOnTouched(fn: any) {\n        this.onTouched = fn;\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        if (isDisabled) {\n            this.form.disable();\n        } else {\n            this.form.enable();\n        }\n    }\n\n    private subscribeValueChanges(): void {\n        this.valueChangesSubscription = merge(this.fieldForm.valueChanges, this.form.valueChanges)\n            .pipe(debounceTime(0))\n            .subscribe(() => this.updateValue());\n    }\n\n    private updateField(field: FormlyFieldConfig): void {\n        if (!isObject(field)) {\n            field = {};\n        }\n        this.key.setValue(isString(field.key) ? field.key : '');\n        this.className.setValue(isString(field.className) ? field.className : '');\n        this.fieldGroupClassName.setValue(isString(field.fieldGroupClassName) ? field.fieldGroupClassName : '');\n        this.type.setValue(isString(field.type) ? field.type : '');\n        this.fields = this.fieldsService.getTypeFields(this.type.value);\n        this.fieldForm = this.fb.group({});\n        this.field = cloneDeep(field);\n    }\n\n    private updateValue(): void {\n        if (!this.onChange) {\n            return;\n        }\n\n        const field = this.field;\n        field.key = this.key.value;\n        field.className = this.className.value;\n        field.fieldGroupClassName = this.fieldGroupClassName.value;\n        field.type = this.type.value;\n        this.onChange(field);\n    }\n\n    private onTypeChange(): void {\n        this.valueChangesSubscription.unsubscribe();\n        const type = this.type.value;\n        this.fields = this.fieldsService.getTypeFields(type);\n        const designerType = this.formlyDesignerConfig.types[type];\n        this.fieldArray = designerType && designerType.fieldArray;\n        this.fieldForm = this.fb.group({});\n        this.field = Object.assign({}, this.field);\n        this.subscribeValueChanges();\n    }\n\n    onWrappersSelected(field: FormlyFieldConfig): void {\n        this.updateField(field);\n    }\n\n    private validator(control: FormGroup): { [key: string]: boolean } {\n        const type = control.get('type') as FormControl;\n        const hasType = isString(type.value) && type.value.trim().length > 0;\n\n        const key = control.get('key') as FormControl;\n        const result = { key: false, type: this.showType && !hasType, conflict: false };\n        if (hasType && (!isString(key.value) || key.value.trim().length === 0)) {\n            result.key = true;\n        }\n\n        return result.key || result.type ? result : null;\n    }\n}\n","import { Component, ElementRef, EventEmitter, Output, ViewChild } from '@angular/core';\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { DesignerTypeOption, FormlyDesignerConfig } from '../formly-designer-config';\n\n@Component({\n    selector: 'formly-designer-field-picker',\n    template: `\n        <form novalidate [formGroup]=\"form\">\n            <div class=\"form-group\">\n                <div class=\"input-group\">\n                    <formly-designer-type-select formControlName=\"type\">\n                    </formly-designer-type-select>\n                    <button type=\"button\" class=\"btn btn-secondary\" [disabled]=\"form.invalid\" (click)=\"add()\">\n                        Add\n                    </button>\n                </div>\n            </div>\n            <div #modal class=\"modal fade\" tabindex=\"-1\" role=\"dialog\">\n                <div class=\"modal-dialog modal-lg\" role=\"document\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <h5 class=\"modal-title\">Add {{ type.value }}</h5>\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Cancel\">\n                                <span aria-hidden=\"true\">&times;</span>\n                            </button>\n                        </div>\n                        <div class=\"modal-body\">\n                            <formly-designer-field-editor #editor [fieldGroup]=\"fieldEdit.value.fieldGroup\" [formControl]=\"fieldEdit\">\n                            </formly-designer-field-editor>\n                        </div>\n                        <div class=\"modal-footer\">\n                            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button>\n                            <button type=\"button\" class=\"btn btn-primary\" (click)=\"onApply()\"\n                                [disabled]=\"editor.invalid\">Apply</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </form>\n    `,\n    styles: [`\n        .btn:not(:disabled) {\n            cursor: pointer;\n        }\n        .input-group > .btn {\n            border-radius: 0 .25rem .25rem 0;\n        }\n        .input-group, .modal-header {\n            display: flex;\n        }\n        .modal-header {\n            justify-content: space-between;\n        }\n        formly-designer-type-select {\n            flex-grow: 2;\n        }\n    `]\n})\nexport class FieldPickerComponent {\n    @ViewChild('modal') modalRef: ElementRef;\n    @Output() selected = new EventEmitter<FormlyFieldConfig>();\n\n    constructor(\n        fb: FormBuilder,\n        private formlyDesignerConfig: FormlyDesignerConfig\n    ) {\n      this.form = fb.group({\n          type: this.type = fb.control('', Validators.compose([Validators.required, Validators.pattern(/^\\s*\\S.*$/)]))\n      });\n    }\n\n    form: FormGroup;\n    readonly fieldEdit = new FormControl({});\n    readonly type: FormControl;\n    fieldGroup: boolean;\n\n    private get $modal(): JQuery & { modal: (command: string) => void } {\n        return $(this.modalRef.nativeElement) as any;\n    }\n\n    add(): void {\n        const type = this.type.value;\n        const field = {} as FormlyFieldConfig;\n        if (type !== 'fieldGroup') {\n          field.type = type;\n        }\n        const designerType = this.formlyDesignerConfig.types[type] || {} as DesignerTypeOption;\n        if (designerType.fieldArray) {\n            field.fieldArray = { fieldGroup: [] };\n        }\n        if (this.fieldGroup = (type === 'fieldGroup' || designerType.fieldGroup)) {\n            field.fieldGroup = [];\n        }\n        this.fieldEdit.setValue(field);\n        this.$modal.modal('show');\n    }\n\n    onApply(): void {\n        this.selected.emit(this.fieldEdit.value);\n        this.$modal.modal('hide');\n    }\n}\n","import { AfterViewInit, Component, forwardRef, OnDestroy, OnInit } from '@angular/core';\nimport { ControlValueAccessor, FormControl, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { Subscription, timer } from 'rxjs';\n\nconst TYPE_SELECT_CONTROL_VALUE_ACCESSOR: any = {\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => TypeSelectComponent),\n    multi: true\n};\n\n@Component({\n    selector: 'formly-designer-type-select',\n    template: `\n        <select [formControl]=\"formControl\" class=\"custom-select\">\n            <option *ngFor=\"let type of types\" [ngValue]=\"type\">{{ type }}</option>\n        </select>\n    `,\n    styles: [`\n        select {\n            width: 100%;\n        }\n    `],\n    providers: [TYPE_SELECT_CONTROL_VALUE_ACCESSOR]\n})\nexport class TypeSelectComponent implements AfterViewInit, ControlValueAccessor, OnDestroy, OnInit {\n    private valueChangesSubscription: Subscription;\n\n    formControl = new FormControl();\n    types: string[];\n\n    constructor(\n        private formlyDesignerConfig: FormlyDesignerConfig\n    ) { }\n\n    protected onChange = (value: any) => { };\n    protected onTouched = () => { };\n\n    ngAfterViewInit(): void {\n        timer().subscribe(() => {\n            this.types = Object.keys(this.formlyDesignerConfig.types);\n            if (this.types.length > 0) {\n                this.formControl.setValue(this.types[0]);\n            }\n            this.types.push('fieldGroup');\n        });\n    }\n\n    ngOnInit(): void {\n        this.valueChangesSubscription = this.formControl.valueChanges.subscribe(value => {\n            if (this.onChange) {\n                this.onChange(value);\n            }\n        });\n    }\n\n    ngOnDestroy(): void {\n        this.valueChangesSubscription.unsubscribe();\n    }\n\n    writeValue(obj: any) {\n        this.formControl.setValue(obj);\n    }\n\n    registerOnChange(fn: any) {\n        this.onChange = fn;\n    }\n\n    registerOnTouched(fn: any) {\n        this.onTouched = fn;\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        if (isDisabled) {\n            this.formControl.disable();\n        } else {\n            this.formControl.enable();\n        }\n    }\n}\n","import { Component, forwardRef, Input, OnChanges, OnDestroy, OnInit, SimpleChanges } from '@angular/core';\nimport { ControlValueAccessor, FormBuilder, FormGroup, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { FieldsService } from '../fields.service';\nimport { Subscription, timer } from 'rxjs';\nimport { debounceTime, switchMap } from 'rxjs/operators';\nimport { cloneDeep, isObject } from '../util';\n\nconst WRAPPER_EDITOR_CONTROL_VALUE_ACCESSOR: any = {\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => WrapperEditorComponent),\n    multi: true\n};\n\n@Component({\n    selector: 'formly-designer-wrapper-editor',\n    template: `\n        <form [formGroup]=\"fieldForm\" novalidate>\n            <div class=\"card\">\n                <div class=\"card-body\">\n                    <formly-form [form]=\"fieldForm\" [fields]=\"fields\" [model]=\"field\">\n                    </formly-form>\n                    <ng-content></ng-content>\n                </div>\n            </div>\n        </form>\n    `,\n    providers: [\n        WRAPPER_EDITOR_CONTROL_VALUE_ACCESSOR\n    ]\n})\nexport class WrapperEditorComponent implements ControlValueAccessor, OnChanges, OnDestroy, OnInit {\n    @Input() wrapper: string;\n\n    private readonly subscriptions: Subscription[] = [];\n    private valueChangesSubscription: Subscription;\n\n    constructor(\n        private fieldsService: FieldsService,\n        private formBuilder: FormBuilder\n    ) {\n        this.fieldForm = formBuilder.group({});\n    }\n\n    invalid: boolean;\n    fieldForm: FormGroup;\n    field: FormlyFieldConfig;\n    fields: FormlyFieldConfig[] = [];\n\n    protected onChange = (value: any) => { };\n    protected onTouched = () => { };\n\n    ngOnInit(): void {\n        this.subscriptions.push(this.fieldForm.statusChanges\n            .pipe(switchMap(() => timer()))\n            .subscribe(() => this.invalid = this.fieldForm.invalid));\n\n        this.subscribeValueChanges();\n    }\n\n    ngOnDestroy(): void {\n        this.valueChangesSubscription.unsubscribe();\n        this.subscriptions.splice(0).forEach(subscription => subscription.unsubscribe());\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n        if (changes.wrapper) {\n            if (this.valueChangesSubscription) {\n                this.valueChangesSubscription.unsubscribe();\n            }\n            this.fields = this.fieldsService.getWrapperFields(this.wrapper);\n            this.fieldForm = this.formBuilder.group({});\n            this.field = Object.assign({}, this.field);\n            if (this.valueChangesSubscription) {\n                this.subscribeValueChanges();\n            }\n        }\n    }\n\n    writeValue(obj: any) {\n        this.valueChangesSubscription.unsubscribe();\n        if (!isObject(obj)) {\n            obj = {};\n        }\n        this.fields = this.fieldsService.getWrapperFields(this.wrapper);\n        this.fieldForm = this.formBuilder.group({});\n        this.field = cloneDeep(obj);\n        this.subscribeValueChanges();\n    }\n\n    registerOnChange(fn: any) {\n        this.onChange = fn;\n    }\n\n    registerOnTouched(fn: any) {\n        this.onTouched = fn;\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        if (isDisabled) {\n            this.fieldForm.disable();\n        } else {\n            this.fieldForm.enable();\n        }\n    }\n\n    private subscribeValueChanges(): void {\n        this.valueChangesSubscription = this.fieldForm.valueChanges\n            .pipe(debounceTime(0))\n            .subscribe(() => this.updateValue());\n    }\n\n    private updateValue(): void {\n        if (!this.onChange) {\n            return;\n        }\n\n        this.onChange(this.field);\n    }\n}\n","import { AfterViewInit, Component, forwardRef, OnDestroy, OnInit } from '@angular/core';\nimport { ControlValueAccessor, FormControl, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { Subscription, timer } from 'rxjs';\n\nconst WRAPPER_SELECT_CONTROL_VALUE_ACCESSOR: any = {\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => WrapperSelectComponent),\n    multi: true\n};\n\n@Component({\n    selector: 'formly-designer-wrapper-select',\n    template: `\n        <select [formControl]=\"formControl\" class=\"custom-select\">\n            <option *ngFor=\"let wrapper of wrappers\" [ngValue]=\"wrapper\">{{ wrapper }}</option>\n        </select>\n    `,\n    styles: [`\n        select {\n            width: 100%;\n        }\n    `],\n    providers: [WRAPPER_SELECT_CONTROL_VALUE_ACCESSOR]\n})\nexport class WrapperSelectComponent implements AfterViewInit, ControlValueAccessor, OnDestroy, OnInit {\n    private valueChangesSubscription: Subscription;\n\n    constructor(\n        private formlyDesignerConfig: FormlyDesignerConfig\n    ) { }\n\n    formControl = new FormControl();\n    wrappers: string[];\n\n    protected onChange = (value: any) => { };\n    protected onTouched = () => { };\n\n    ngAfterViewInit(): void {\n        timer().subscribe(() => {\n            this.wrappers = Object.keys(this.formlyDesignerConfig.wrappers);\n            if (this.wrappers.length > 0) {\n                this.formControl.setValue(this.wrappers[0]);\n            }\n        });\n    }\n\n    ngOnInit(): void {\n        this.valueChangesSubscription = this.formControl.valueChanges.subscribe(value => {\n            if (this.onChange) {\n                this.onChange(value);\n            }\n        });\n    }\n\n    ngOnDestroy(): void {\n        this.valueChangesSubscription.unsubscribe();\n    }\n\n    writeValue(obj: any) {\n        this.formControl.setValue(obj);\n    }\n\n    registerOnChange(fn: any) {\n        this.onChange = fn;\n    }\n\n    registerOnTouched(fn: any) {\n        this.onTouched = fn;\n    }\n\n    setDisabledState(isDisabled: boolean): void {\n        if (isDisabled) {\n            this.formControl.disable();\n        } else {\n            this.formControl.enable();\n        }\n    }\n}\n","import { Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild } from '@angular/core';\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { FormlyDesignerService } from '../formly-designer.service';\nimport { cloneDeep, isArray, isObject } from '../util';\n\ndeclare var $;\n\n@Component({\n    selector: 'formly-designer-wrapper-picker',\n    template: `\n        <form novalidate [formGroup]=\"form\">\n            <div class=\"form-group\">\n                <div class=\"input-group\">\n                    <formly-designer-wrapper-select formControlName=\"wrapper\">\n                    </formly-designer-wrapper-select>\n                    <button type=\"button\" class=\"btn btn-secondary\" [disabled]=\"form.invalid\" (click)=\"add()\">\n                        Add\n                    </button>\n                </div>\n            </div>\n            <div #modal class=\"modal fade\" tabindex=\"-1\" role=\"dialog\">\n                <div class=\"modal-dialog modal-lg\" role=\"document\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <h5 class=\"modal-title\">Add {{ wrapper }}</h5>\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Cancel\">\n                                <span aria-hidden=\"true\">&times;</span>\n                            </button>\n                        </div>\n                        <div class=\"modal-body\">\n                            <formly-designer-wrapper-editor #editor [formControl]=\"fieldEdit\" [wrapper]=\"wrapper\">\n                            </formly-designer-wrapper-editor>\n                        </div>\n                        <div class=\"modal-footer\">\n                            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button>\n                            <button type=\"button\" class=\"btn btn-primary\" (click)=\"onApply()\"\n                                [disabled]=\"editor.invalid\">Apply</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </form>\n    `,\n    styles: [`\n        :host {\n            width: inherit;\n        }\n        .btn:not(:disabled) {\n            cursor: pointer;\n        }\n        .input-group > .btn {\n            border-radius: 0 .25rem .25rem 0;\n        }\n        .input-group, .modal-header {\n            display: flex;\n        }\n        .modal-header {\n            justify-content: space-between;\n        }\n        formly-designer-wrapper-select {\n            flex-grow: 2;\n        }\n    `]\n})\nexport class WrapperPickerComponent implements OnInit {\n    @ViewChild('modal') modalRef: ElementRef;\n    @Input() field: FormlyFieldConfig;\n    @Output() selected = new EventEmitter<FormlyFieldConfig>();\n\n    constructor(\n        private formBuilder: FormBuilder,\n        private formlyDesignerConfig: FormlyDesignerConfig,\n        private formlyDesignerService: FormlyDesignerService\n    ) { }\n\n    form: FormGroup;\n    fieldEdit = new FormControl({});\n\n    get wrapper(): string {\n        return this.form.get('wrapper').value;\n    }\n\n    private get $modal(): JQuery & { modal: (command: string) => void } {\n        return $(this.modalRef.nativeElement);\n    }\n\n    ngOnInit(): void {\n        this.form = this.formBuilder.group({\n            wrapper: ['', Validators.compose([Validators.required, Validators.pattern(/^\\s*\\S.*$/)])]\n        });\n    }\n\n    add(): void {\n        if (isObject(this.field)) {\n            const field = cloneDeep(this.field);\n            if (isArray(field.wrappers) && field.wrappers.length > 0) {\n                field.wrappers.splice(field.wrappers.length - 1, 0, this.wrapper);\n            } else {\n                field.wrappers = [this.wrapper];\n            }\n            this.fieldEdit.setValue(field);\n\n            const fields = this.formlyDesignerConfig.wrappers[this.wrapper].fields;\n            if (isArray(fields) && fields.length > 0) {\n                this.$modal.modal('show');\n            } else {\n                this.onApply();\n            }\n        }\n    }\n\n    onApply(): void {\n        this.field = this.formlyDesignerService.convertField(this.fieldEdit.value);\n        this.selected.emit(this.fieldEdit.value);\n        this.$modal.modal('hide');\n    }\n}\n","import { Component, ElementRef, EventEmitter, Input, OnChanges, Output, SimpleChanges, ViewChild } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { FormlyDesignerConfig } from '../formly-designer-config';\nimport { FormlyDesignerService } from '../formly-designer.service';\nimport { cloneDeep, isArray, isObject } from '../util';\n\n@Component({\n    selector: 'formly-designer-wrappers-picker',\n    template: `\n        <div class=\"form-group\">\n            <div class=\"input-group\">\n                <formly-designer-wrapper-picker [field]=\"field\" (selected)=\"onWrapperSelected($event)\">\n                </formly-designer-wrapper-picker>\n            </div>\n            <div *ngFor=\"let wrapper of wrappers; let i = index\" class=\"badge badge-default noselect\" (click)=\"edit(i)\">\n                {{ wrapper }}&nbsp;&nbsp;<i class=\"fa fa-times\" aria-hidden=\"true\" (click)=\"remove(i)\"></i>\n            </div>\n        </div>\n        <div #modal class=\"modal fade\" tabindex=\"-1\" role=\"dialog\">\n            <div class=\"modal-dialog modal-lg\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <h5 class=\"modal-title\">Edit {{ wrapper }}</h5>\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Cancel\">\n                            <span aria-hidden=\"true\">&times;</span>\n                        </button>\n                    </div>\n                    <div class=\"modal-body\">\n                        <formly-designer-wrapper-editor #editor [formControl]=\"fieldEdit\" [wrapper]=\"wrapper\">\n                        </formly-designer-wrapper-editor>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Cancel</button>\n                        <button type=\"button\" class=\"btn btn-primary\" (click)=\"onApply()\"\n                            [disabled]=\"editor.invalid\">Apply</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [`\n        .badge {\n            margin-right: .25em;\n        }\n        .badge {\n            cursor: pointer;\n        }\n        .noselect {\n            -webkit-user-select: none;\n            -khtml-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n        }\n    `]\n})\nexport class WrappersPickerComponent implements OnChanges {\n    @ViewChild('modal') modalRef: ElementRef;\n    @Input() field: FormlyFieldConfig;\n    @Output() selected = new EventEmitter<FormlyFieldConfig>();\n\n    wrapper: string;\n    fieldEdit = new FormControl({});\n\n    wrappers: string[] = [];\n\n    constructor(\n        private formlyDesignerConfig: FormlyDesignerConfig,\n        private formlyDesignerService: FormlyDesignerService\n    ) { }\n\n    ngOnChanges(changes: SimpleChanges) {\n        if (changes.field) {\n            this.wrappers = this.formlyDesignerService.getWrappers(changes.field.currentValue);\n        }\n    }\n\n    private get $modal(): JQuery & { modal: (command: string) => void } {\n        return $(this.modalRef.nativeElement) as any;\n    }\n\n    onWrapperSelected(field: FormlyFieldConfig): void {\n        this.selected.emit(field);\n    }\n\n    edit(index: number): void {\n        this.wrapper = this.wrappers[index];\n        if (isObject(this.field)) {\n            const field = cloneDeep(this.field);\n            if (isArray(field.wrappers)) {\n                this.fieldEdit.setValue(field);\n\n                const fields = this.formlyDesignerConfig.wrappers[this.wrapper].fields;\n                if (isArray(fields) && fields.length > 0) {\n                    this.$modal.modal('show');\n                } else {\n                    this.onApply();\n                }\n            }\n        }\n    }\n\n    remove(index: number): void {\n        const fieldWrappersIndex = this.field.wrappers.indexOf(this.wrappers[index]);\n        if (fieldWrappersIndex < 0) {\n            return;\n        }\n\n        const field = cloneDeep(this.field);\n        field.wrappers.splice(fieldWrappersIndex, 1);\n        this.field = this.formlyDesignerService.convertField(field);\n        this.selected.emit(this.field);\n    }\n\n    onApply(): void {\n        this.field = this.formlyDesignerService.convertField(this.fieldEdit.value);\n        this.selected.emit(this.field);\n        this.$modal.modal('hide');\n    }\n}\n","import { cloneDeep, isArray, isObject } from './util';\n\nexport function decycle<T>(value: T): T {\n    if (value == null) {\n        return value;\n    }\n\n    let nextId = 1;\n    const objects = new Map<any, number>();\n    return traverse(cloneDeep(value), (key, v) => {\n        if (isObject(v)) {\n            if (objects.has(v)) {\n                let id = objects.get(v);\n                if (!id) {\n                    v.$id = id = nextId++;\n                    objects.set(v, id);\n                }\n                return { $ref: id };\n            } else {\n                objects.set(v, 0);\n            }\n        }\n    });\n}\n\nfunction traverse<T>(obj: T, replace: (key, value) => any): T {\n    if (isArray(obj)) {\n        for (let i = 0; i < (obj as any).length; i++) {\n            traverseValue.bind(obj, i, obj[i], replace)();\n        }\n    } else if (isObject(obj)) {\n        for (const key in obj) {\n            if (obj.hasOwnProperty(key)) {\n                traverseValue.bind(obj, key, obj[key], replace)();\n            }\n        }\n    }\n    return obj;\n}\n\nfunction traverseValue(key: any, value: any, replace: (key, value) => any): void {\n    const replacement = replace(key, value);\n    if (replacement === undefined) {\n        traverse(value, replace);\n    } else {\n        this[key] = replacement;\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { decycle } from '../json-helper';\n\n@Pipe({ name: 'decycle' })\nexport class DecyclePipe implements PipeTransform {\n    transform(value: any): any {\n        return decycle(value);\n    }\n}\n","import { NgModule, ModuleWithProviders, ANALYZE_FOR_ENTRY_COMPONENTS } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { FieldEditorComponent } from './components/field-editor';\nimport { FieldPickerComponent } from './components/field-picker';\nimport { FieldsService } from './fields.service';\nimport { FormlyConfig, FormlyForm, FormlyModule } from '@ngx-formly/core';\nimport { FormlyDesignerComponent } from './formly-designer.component';\nimport { DesignerConfigOption, FormlyDesignerConfig, FORMLY_DESIGNER_CONFIG_TOKEN } from './formly-designer-config';\nimport { config, fieldComponents, wrapperComponents } from './config';\nimport { TypeSelectComponent } from './components/type-select';\nimport { WrapperEditorComponent } from './components/wrapper-editor';\nimport { WrapperSelectComponent } from './components/wrapper-select';\nimport { WrapperPickerComponent } from './components/wrapper-picker';\nimport { WrappersPickerComponent } from './components/wrappers-picker';\nimport { DecyclePipe } from './pipes/decycle';\nimport 'jquery';\n\n@NgModule({\n    declarations: [\n        FieldEditorComponent,\n        FieldPickerComponent,\n        FormlyDesignerComponent,\n        TypeSelectComponent,\n        WrapperEditorComponent,\n        WrapperSelectComponent,\n        WrapperPickerComponent,\n        WrappersPickerComponent,\n\n        DecyclePipe,\n\n        fieldComponents,\n        wrapperComponents\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n\n        FormlyModule.forChild()\n    ],\n    exports: [\n        FormlyDesignerComponent\n    ],\n    providers: [\n        FormlyDesignerConfig,\n        FieldsService\n    ],\n    entryComponents: [FormlyForm]\n})\nexport class FormlyDesignerModule {\n    constructor(\n        formlyConfig: FormlyConfig\n    ) {\n        formlyConfig.addConfig(config);\n    }\n\n    static forRoot(designerConfig: DesignerConfigOption = {}): ModuleWithProviders {\n        return {\n            ngModule: FormlyDesignerModule,\n            providers: [\n                { provide: ANALYZE_FOR_ENTRY_COMPONENTS, useValue: [fieldComponents, wrapperComponents], multi: true },\n                { provide: FORMLY_DESIGNER_CONFIG_TOKEN, useValue: designerConfig, multi: true }\n            ]\n        };\n    }\n}\n"]}